# version that works on che.openshift.io
apiVersion: 1.0.0
metadata:
   generateName: che-website-
attributes:
  persistVolumes: 'false'
  
components:

  - alias: php
    type: dockerimage
    image: registry.redhat.io/codeready-workspaces/stacks-php-rhel8@sha256:3f6dc2515ef3ce5f7d28368f3159c357973a633300a57a809d8c3044bb685719
    mountSources: true
    memoryLimit: 256M
    args: ['sleep', 'infinity']
    endpoints:
      - name: 'website'
        port: 80
        attributes:
          path: /che/

commands:

  - name: start che-website
    actions:
      - type: exec
        command: >-
          if [ ! -f "/projects/che" ]; then ln -s /projects/che-website/che ; fi ;
          service apache2 start && tail -f /var/log/apache2/access.log -f /var/log/apache2/error.log
        component: php
        workdir: /projects/
